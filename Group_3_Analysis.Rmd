---
title: "Group_3_Analysis"
author: "Group_3"
date: "2023-03-10"
output: html_document
---
# Aim of Analysis

# Exploratory Analysis

## Data Wrangling
```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#load library
library(dplyr)
library(tidyr)
library(skimr)
library(tidytext)
library(stringr)
```

```{r Binary output label}
imdb <- read.csv("https://raw.githubusercontent.com/fanghuaqiu/DMML-Group-3/main/group_3.csv",na.strings = "") %>%
  mutate(ROI = (gross-budget)/budget) %>% #define ROI
  mutate(scs = ifelse(ROI>=1,1,0)) %>% #define binary labelled output
  mutate(title_year = as.factor(title_year),
         aspect_ratio = as.factor((aspect_ratio)),
         scs = as.factor(scs),
         content_rating = replace_na(content_rating, "Unknown"),
         country = str_replace(country," ","_"),
         content_rating = str_replace(content_rating," ","_"))%>%
  mutate(content_rating = str_replace(content_rating,"-1","_1"))
```


```{r turn categorical variable to dummy variable}
#Turn genres into matrix
imdb_genre <- imdb[,c("movie_title","genres")] %>%
  mutate(has=1) %>%
  unnest_tokens(genres_c, genres, to_lower=F) %>%
  filter(genres_c != "Fi" & genres_c != "Film") %>%
  group_by(movie_title) %>%
  spread(genres_c,has,fill=0)

#turn categorical variable into dummy variables
dummies <- model.matrix(~color+language+country+title_year+aspect_ratio+content_rating,data=imdb)[,-1]

#Combine datasets, need to adjust for standised data
imdb_dummy <- cbind(imdb,dummies) %>%
    left_join(imdb_genre, by = "movie_title")

skim(imdb_dummy)
```


```{r Separate training, validation and test sets}
same_sample <- function(x,y){
  set.seed(84)
  return(sample(x,y))
}

index_test <- same_sample(1:nrow(imdb), round(0.25*nrow(imdb)))
index_val <- same_sample((1:nrow(imdb))[-index_test], round(0.25*nrow(imdb)))
index_train <- setdiff(1:nrow(imdb),c(index_test,index_val))

test_imdb <- imdb_dummy[index_test,]
vaild_imdb <- imdb_dummy[index_val,]
train_imdb <- imdb_dummy[index_train,]
```

# Modelling

## KNN

## LDA

## Tree

## SVM
```{r SVM}
Model <- svm(scs~.,data = train_imdb, type="C-classification", kernel="linear",cost = 0.1)
summary(Model)
aa2=predict(Model,valid_imdb)
table(valid_imdb$scs,aa2)
length(valid_imdb$scs)
length(aa2)
sum(diag(table(valid_imdb$scs,aa2)))/length(aa2)

cost_range <- c(0.01,0.1,1,10,100,150)
degree_range <- 2:20
gamma_range <- c(0.001,0.01,0.1,1,10,100)

SVM_poly <- tune.svm(scs~., data=train_imdb, type="C-classification", kernel="polynomial", cost=cost_range, degree=degree_range)
summary(SVM_poly)

SVM_RBF <- tune.svm(scs~., data=train_imdb, type="C-classification", kernel="radial", cost=cost_range, gamma=gamma_range)
summary(SVM_RBF)

SVM_linear <- tune.svm(scs~.,data = train_imdb,type="C-classification",kernel="linear",cost = cost_range)
summary(SVM_linear)


gamma.opt <- SVM_poly$best.parameters[1]
cost.opt <- SVM_poly$best.parameters[2]
SVM_final <- svm(scs~., train_imdb, type="C-classification", kernel="polynomial", gamma=gamma.opt, cost=cost.opt)
test.pred <- predict(SVM_final,valid_imdb)
table(valid_imdb$scs,test.pred)
sum(diag(table(valid_imdb$scs,test.pred)))/length(valid_imdb$scs)


gamma.opt <- SVM_RBF$best.parameters[1]
cost.opt <- SVM_RBF$best.parameters[2]
SVM_final <- svm(scs~., train_imdb, type="C-classification", kernel="radial", gamma=gamma.opt, cost=cost.opt)
test.pred <- predict(SVM_final,valid_imdb)
table(valid_imdb$scs,test.pred)
sum(diag(table(valid_imdb$scs,test.pred)))/length(valid_imdb$scs)


cost.opt <- SVM_linear$best.parameters[1]
SVM_final <- svm(scs~., train_imdb, type="C-classification", kernel="linear",cost=cost.opt)
test.pred <- predict(SVM_final,valid_imdb)
table(valid_imdb$scs,test.pred)
sum(diag(table(valid_imdb$scs,test.pred)))/length(valid_imdb$scs)


```

##Neural Network

#Conclusion

```


